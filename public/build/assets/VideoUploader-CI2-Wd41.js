import{d as c,p as E,o as l,e as n,a as r,n as f,t as g,f as y,j}from"./app-Dsnmz9Rv.js";const B={class:"flex flex-col items-center space-y-4"},z={class:"relative"},T=["src","alt"],U={key:2,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity duration-200 rounded"},W=["disabled"],D=["disabled"],N={key:1,class:"mt-4"},F=["src"],I={class:"mt-2 space-x-2"},q=["disabled"],A=["disabled"],R={__name:"VideoUploader",props:{currentVideo:{type:String,default:""},section:{type:String,required:!0},name:{type:String,required:!0},alt:{type:String,default:"Video"},videoClass:{type:String,default:"w-full h-64 object-cover rounded"},previewClass:{type:String,default:"w-48 h-32 object-cover border-2 border-blue-300 rounded"},buttonText:{type:String,default:"Seleccionar video"},showEditButton:{type:Boolean,default:!1},maxSize:{type:Number,default:100}},emits:["videoUpdated"],setup(s,{emit:C}){const t=s,b=c(null),v=c(null),m=c(null),o=c(!1),d=c(""),x=c(""),h=E(()=>t.currentVideo?t.currentVideo.startsWith("/storage/")?t.currentVideo:t.currentVideo.startsWith("storage/")?"/"+t.currentVideo:t.currentVideo.startsWith("http")||t.currentVideo.startsWith("/")?t.currentVideo:`/storage/${t.currentVideo}`:"/videos/placeholder.mp4"),V=()=>{b.value.click()},S=i=>{const e=i.target.files[0];if(e){if(!e.type.startsWith("video/")){u("Por favor selecciona un archivo de video válido","error");return}if(e.size>t.maxSize*1024*1024){u(`El video debe ser menor a ${t.maxSize}MB`,"error");return}m.value=e;const a=new FileReader;a.onload=p=>{v.value=p.target.result},a.readAsDataURL(e)}},k=async()=>{var i,e;if(!m.value){u("No hay archivo seleccionado","error");return}o.value=!0,d.value="";try{const a=new FormData;a.append("video",m.value),a.append("section",t.section),a.append("name",t.name);const p=await j.post("/api/media/upload-video",a,{headers:{"Content-Type":"multipart/form-data"}});p.data.success?(v.value=null,m.value=null,b.value.value="",u("Video actualizado exitosamente","success"),_("videoUpdated",p.data.data)):u(p.data.message||"Error al subir el video","error")}catch(a){console.error("Error al subir el video:",a),u(((e=(i=a.response)==null?void 0:i.data)==null?void 0:e.message)||"Error al subir el video. Inténtalo de nuevo.","error")}finally{o.value=!1}},w=()=>{v.value=null,m.value=null,b.value.value="",d.value=""},u=(i,e)=>{d.value=i,x.value=e,setTimeout(()=>{d.value=""},5e3)},_=C;return(i,e)=>(l(),n("div",B,[r("div",z,[h.value&&h.value!=="/videos/placeholder.mp4"?(l(),n("video",{key:0,src:h.value,alt:s.alt,class:f(s.videoClass),controls:"",preload:"metadata"},null,10,T)):(l(),n("div",{key:1,class:f(["bg-gray-200 flex items-center justify-center",s.videoClass])},e[0]||(e[0]=[r("span",{class:"text-gray-500"},"Sin video",-1)]),2)),s.showEditButton?(l(),n("div",U,[r("button",{class:"bg-white text-gray-800 px-3 py-1 rounded text-sm font-medium",onClick:V,disabled:o.value},g(o.value?"Subiendo...":"Editar"),9,W)])):y("",!0)]),s.showEditButton?y("",!0):(l(),n("button",{key:0,class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md transition-colors duration-200",onClick:V,disabled:o.value},g(o.value?"Subiendo...":s.buttonText),9,D)),r("input",{type:"file",ref_key:"fileInput",ref:b,onChange:S,accept:"video/*",class:"hidden"},null,544),v.value?(l(),n("div",N,[e[1]||(e[1]=r("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Vista previa:",-1)),r("video",{src:v.value,alt:"Vista previa",class:f(s.previewClass),controls:"",preload:"metadata"},null,10,F),r("div",I,[r("button",{onClick:k,disabled:o.value,class:"bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white px-3 py-1 rounded text-sm"},g(o.value?"Subiendo...":"Confirmar"),9,q),r("button",{onClick:w,disabled:o.value,class:"bg-red-500 hover:bg-red-600 disabled:bg-gray-400 text-white px-3 py-1 rounded text-sm"}," Cancelar ",8,A)])])):y("",!0),d.value?(l(),n("div",{key:2,class:f(["mt-2 p-2 rounded text-sm",x.value==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},g(d.value),3)):y("",!0)]))}};export{R as _};
